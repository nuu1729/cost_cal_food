<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊñôÁêÜÂéü‰æ°Ë®àÁÆó</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #f8fbff 100%);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 120px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* „Éá„Éº„ÇøÁÆ°ÁêÜ„Éú„Çø„É≥ */
        .data-management {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 999;
            display: flex;
            gap: 10px;
            flex-direction: column;
        }

        .data-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #1976d2;
            color: #1976d2;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-align: center;
            min-width: 80px;
        }

        .data-btn:hover {
            background: #1976d2;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(25, 118, 210, 0.3);
        }

        .data-btn.search {
            border-color: #9c27b0;
            color: #9c27b0;
        }

        .data-btn.search:hover {
            background: #9c27b0;
            color: white;
        }

        .data-btn.danger {
            border-color: #f44336;
            color: #f44336;
        }

        .data-btn.danger:hover {
            background: #f44336;
            color: white;
        }

        h1 {
            text-align: center;
            color: #1976d2;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .main-content {
            display: grid;
            grid-template-columns: 320px 320px 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* „Éë„Éç„É´ÂÖ±ÈÄö„Çπ„Çø„Ç§„É´ */
        .panel {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            height: fit-content;
        }

        .panel-title {
            color: #1976d2;
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-title::before {
            content: "üõí";
            font-size: 1.2rem;
        }

        /* „Éï„Ç©„Éº„É† */
        .form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(144, 202, 249, 0.1);
            border-radius: 15px;
            border: 2px dashed #90caf9;
        }

        .form-title {
            font-weight: 600;
            color: #1976d2;
            margin-bottom: 10px;
            text-align: center;
        }

        input[type="text"], input[type="number"], select {
            padding: 14px 16px;
            border: 2px solid #e3f2fd;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            min-height: 48px;
        }

        input[type="text"]:focus, input[type="number"]:focus, select:focus {
            outline: none;
            border-color: #42a5f5;
            box-shadow: 0 0 0 3px rgba(66, 165, 245, 0.2);
        }

        .add-btn {
            background: linear-gradient(45deg, #42a5f5, #1976d2);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(66, 165, 245, 0.4);
        }

        /* „Ç¢„Ç§„ÉÜ„É†„É™„Çπ„Éà */
        .item-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .item {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #e3f2fd;
            border-radius: 15px;
            padding: 15px;
            cursor: grab;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(66, 165, 245, 0.2);
            border-color: #90caf9;
        }

        .item:active {
            cursor: grabbing;
            transform: rotate(2deg) scale(1.05);
            z-index: 1000;
        }

        .item-name {
            font-weight: 600;
            color: #1976d2;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        .item-details {
            font-size: 0.9rem;
            color: #555;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .item-store {
            font-size: 0.8rem;
            color: #666;
            font-style: italic;
            margin-bottom: 4px;
        }

        .item-buttons {
            display: flex;
            gap: 5px;
        }

        .edit-btn {
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .edit-btn:hover {
            background: #388e3c;
            transform: scale(1.1);
        }

        .delete-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 4px 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .delete-btn:hover {
            background: #ff5252;
            transform: scale(1.1);
        }

        /* ÊñôÁêÜ‰ΩúÊàê„Ç®„É™„Ç¢ */
        .small-dishes-panel .panel-title::before {
            content: "üç≥";
        }

        .dish-form {
            background: rgba(76, 175, 80, 0.1);
            border: 2px dashed #81c784;
        }

        .dish-builder {
            min-height: 150px;
            background: rgba(255, 255, 255, 0.8);
            border: 3px dashed #81c784;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            position: relative;
            transition: all 0.3s ease;
        }

        .dish-builder.drag-over {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.1);
            transform: scale(1.02);
        }

        .dish-builder-title {
            text-align: center;
            color: #4caf50;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .dish-ingredients {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .dish-ingredient {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid #81c784;
            border-radius: 8px;
            padding: 8px;
            font-size: 0.9rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dish-ingredient-remove {
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 10px;
        }

        .dish-total {
            text-align: center;
            font-weight: 600;
            color: #4caf50;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #e8f5e8;
        }

        .small-dish-item {
            border-color: #e8f5e8;
        }

        .small-dish-item:hover {
            border-color: #81c784;
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.2);
        }

        .small-dish-item .item-name {
            color: #4caf50;
        }

        /* FOOD„Ç®„É™„Ç¢ */
        .food-section {
            background: rgba(255, 255, 255, 0.7);
            border: 3px dashed #ff9800;
            border-radius: 20px;
            padding: 25px;
            min-height: 400px;
            transition: all 0.3s ease;
            position: relative;
            text-align: center;
        }

        .food-section.drag-over {
            border-color: #f57c00;
            background: rgba(255, 152, 0, 0.1);
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(255, 152, 0, 0.3);
        }

        .food-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .food-icon {
            font-size: 4rem;
            margin-bottom: 10px;
        }

        .food-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #f57c00;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .food-items {
            display: flex;
            flex-direction: column;
            gap: 12px;
            min-height: 250px;
        }

        .food-item {
            background: linear-gradient(45deg, #fff3e0, #ffeaa7);
            border: 2px solid #ff9800;
            border-radius: 12px;
            padding: 12px;
            position: relative;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .food-item-name {
            font-weight: 600;
            color: #e65100;
        }

        .food-item-cost {
            font-size: 0.9rem;
            color: #f57c00;
            margin-top: 4px;
        }

        .food-item-details {
            font-size: 0.8rem;
            color: #666;
            margin-top: 4px;
        }

        .food-subtotal {
            background: rgba(255, 152, 0, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-weight: 600;
            color: #f57c00;
            font-size: 1.2rem;
        }

        .empty-state {
            color: #999;
            font-style: italic;
            padding: 20px;
            text-align: center;
        }

        .remove-food-item {
            position: absolute;
            top: 5px;
            right: 8px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .remove-food-item:hover {
            background: #ff5252;
            transform: scale(1.2);
        }

        .finish-food-btn {
            background: linear-gradient(45deg, #ff9800, #f57c00);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
            margin-top: 20px;
        }

        .finish-food-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
        }

        /* ÂÆåÊàêÂìÅ„Éë„Éç„É´ */
        .finished-foods-panel {
            grid-column: 1 / -1;
            margin-top: 30px;
        }

        .finished-foods-panel .panel-title::before {
            content: "üèÜ";
        }

        .finished-foods-panel .panel-title {
            color: #ff6f00;
        }

        .finished-food-item {
            border-color: #ffe0b2;
            cursor: pointer;
        }

        .finished-food-item:hover {
            border-color: #ffcc02;
            box-shadow: 0 8px 25px rgba(255, 152, 0, 0.2);
        }

        .finished-food-item .item-name {
            color: #ff6f00;
        }

        /* „É¢„Éº„ÉÄ„É´ */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 80%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e3f2fd;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1976d2;
        }

        .close {
            color: #aaa;
            font-size: 2rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #000;
        }

        /* ‰æ°Ê†ºÊ§úÁ¥¢„É¢„Éº„ÉÄ„É´ */
        .search-modal-content {
            max-width: 800px;
            width: 90%;
        }

        .search-input-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .search-filters {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .filter-row {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            min-width: 200px;
        }

        .filter-row label {
            min-width: 60px;
            font-weight: 600;
            color: #555;
        }

        .filter-row select {
            flex: 1;
            padding: 10px;
            border: 2px solid #e3f2fd;
            border-radius: 8px;
            font-size: 14px;
        }

        .search-results {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            background: #fafafa;
        }

        .search-result-item {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            background: white;
            margin: 8px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item.cheapest {
            background: linear-gradient(45deg, #c8e6c9, #e8f5e8);
            border: 2px solid #4caf50;
            font-weight: 600;
            animation: highlight 1s ease-in-out;
        }

        @keyframes highlight {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .search-result-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .search-result-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1976d2;
        }

        .search-result-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2e7d32;
        }

        .search-result-details {
            display: flex;
            justify-content: space-between;
            color: #666;
            font-size: 0.9rem;
        }

        .search-result-store {
            background: #e3f2fd;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            color: #1976d2;
        }

        .cheapest-badge {
            background: #4caf50;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 8px;
        }

        .no-results {
            text-align: center;
            color: #999;
            font-style: italic;
            padding: 40px;
        }

        .edit-input-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .edit-input-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .edit-input-row label {
            min-width: 80px;
            font-weight: 600;
            color: #555;
        }

        .edit-input-row input {
            flex: 1;
            padding: 10px;
            border: 2px solid #e3f2fd;
            border-radius: 8px;
            font-size: 14px;
        }

        .edit-input-row input:read-only {
            background-color: #f5f5f5;
            color: #666;
        }

        .edit-input-row span {
            font-weight: 600;
            color: #666;
            min-width: 30px;
        }

        .edit-preview {
            background: rgba(76, 175, 80, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-weight: 600;
            color: #2e7d32;
            text-align: center;
        }

        .quantity-input-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .quantity-input-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .quantity-input-row label {
            min-width: 80px;
            font-weight: 600;
            color: #555;
        }

        .quantity-input-row input,
        .quantity-input-row select {
            flex: 1;
            padding: 10px;
            border: 2px solid #e3f2fd;
            border-radius: 8px;
            font-size: 14px;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .modal-btn.confirm {
            background: #4caf50;
            color: white;
        }

        .modal-btn.confirm:hover {
            background: #388e3c;
        }

        .modal-btn.cancel {
            background: #f5f5f5;
            color: #666;
        }

        .modal-btn.cancel:hover {
            background: #e0e0e0;
        }

        .cost-preview {
            background: rgba(76, 175, 80, 0.1);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-weight: 600;
            color: #2e7d32;
            text-align: center;
        }

        /* ÂêàË®à„Ç®„É™„Ç¢ */
        .total-area {
            background: linear-gradient(45deg, #ff9800, #f57c00);
            color: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 8px 32px rgba(255, 152, 0, 0.3);
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 300px;
            max-width: 400px;
        }

        .total-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .total-amount {
            font-size: 3rem;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ„Éá„Ç∂„Ç§„É≥ */
        @media (max-width: 1400px) {
            .main-content {
                grid-template-columns: 1fr 1fr;
                gap: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .total-area {
                min-width: 250px;
                max-width: 300px;
            }
            
            body {
                padding-bottom: 300px;
            }
        }

        @media (max-width: 1000px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            body {
                padding-bottom: 120px;
            }
        }

        /* „Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞„Éâ„É≠„ÉÉ„Éó„Ç®„É™„Ç¢ */
        .floating-drop-area {
            position: fixed;
            z-index: 1500;
            min-width: 350px;
            max-width: 450px;
            backdrop-filter: blur(4px);
            display: none;
            pointer-events: auto;
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .floating-drop-area.show {
            display: block;
        }

        .floating-dish-builder {
            background: linear-gradient(45deg, #4caf50, #388e3c);
            color: white;
        }

        .floating-food-area {
            background: linear-gradient(45deg, #ff9800, #f57c00);
            color: white;
        }

        .floating-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
        }

        .floating-content {
            background: rgba(255, 255, 255, 0.9);
            border: 3px dashed #81c784;
            border-radius: 15px;
            padding: 20px;
            min-height: 150px;
            position: relative;
            transition: all 0.3s ease;
            color: #333;
            text-align: center;
        }

        .floating-food-area .floating-content {
            border-color: #ffb74d;
        }

        .floating-content.drag-over {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .floating-dish-builder .floating-content.drag-over {
            border-color: #4caf50;
            background: rgba(76, 175, 80, 0.15);
        }

        .floating-food-area .floating-content.drag-over {
            border-color: #f57c00;
            background: rgba(255, 152, 0, 0.15);
        }

        /* ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏ */
        .success-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #4caf50;
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            z-index: 3000;
            box-shadow: 0 4px 20px rgba(76, 175, 80, 0.3);
            animation: fadeInOut 2s ease-in-out;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        /* „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏ */
        .error-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #f44336;
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            z-index: 3000;
            box-shadow: 0 4px 20px rgba(244, 67, 54, 0.3);
            animation: fadeInOut 3s ease-in-out;
        }

        /* Êõ¥Êñ∞„É°„ÉÉ„Çª„Éº„Ç∏ */
        .update-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #ff9800;
            color: white;
            padding: 20px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            z-index: 3000;
            box-shadow: 0 4px 20px rgba(255, 152, 0, 0.3);
            animation: fadeInOut 3s ease-in-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- „Éá„Éº„ÇøÁÆ°ÁêÜ„Éú„Çø„É≥ -->
        <div class="data-management">
            <button class="data-btn" onclick="exportData()" title="„Éá„Éº„Çø„ÇíJSON„Éï„Ç°„Ç§„É´„Å®„Åó„Å¶„ÉÄ„Ç¶„É≥„É≠„Éº„Éâ">üíæ ‰øùÂ≠ò</button>
            <button class="data-btn" onclick="importData()" title="JSON„Éï„Ç°„Ç§„É´„Åã„Çâ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø">üìÅ Ë™≠„ÅøËæº„Åø</button>
            <button class="data-btn" onclick="loadSampleData()" title="„Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø">üìã „Çµ„É≥„Éó„É´</button>
            <button class="data-btn search" onclick="openPriceSearch()" title="‰æ°Ê†ºÊ§úÁ¥¢">üîç ‰æ°Ê†ºÊ§úÁ¥¢</button>
            <button class="data-btn danger" onclick="clearAllData()" title="„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§">üóëÔ∏è „ÇØ„É™„Ç¢</button>
        </div>

        <h1>üçΩÔ∏è ÊñôÁêÜÂéü‰æ°Ë®àÁÆó„Ç∑„Çπ„ÉÜ„É†</h1>
        
        <div class="main-content">
            <!-- È£üÊùê„Éë„Éç„É´ -->
            <div class="panel">
                <div class="panel-title">Ë≥ºÂÖ•È£üÊùê</div>
                
                <div class="form">
                    <div class="form-title">È£üÊùêË≥ºÂÖ•ÁôªÈå≤</div>
                    <input type="text" id="ingredient-name" placeholder="È£üÊùêÂêçÔºà‰æãÔºöÈ∂è„ÇÇ„ÇÇËÇâÔºâ" />
                    <select id="ingredient-store">
                        <option value="DIO">DIO</option>
                        <option value="„Ç≥„Çπ„É¢„Çπ">„Ç≥„Çπ„É¢„Çπ</option>
                        <option value="„Ç≥„Éº„Éó">„Ç≥„Éº„Éó</option>
                        <option value="„Éã„Ç∑„Éä">„Éã„Ç∑„Éä</option>
                        <option value="‰ªïÂÖ•„Çå">‰ªïÂÖ•„Çå</option>
                    </select>
                    <input type="number" id="ingredient-quantity" placeholder="Ë≥ºÂÖ•Èáè" step="0.1" />
                    <select id="ingredient-unit">
                        <option value="g">gÔºà„Ç∞„É©„É†Ôºâ</option>
                        <option value="ÂÄã">ÂÄãÔºàÂÄãÊï∞Ôºâ</option>
                    </select>
                    <input type="number" id="ingredient-price" placeholder="Ë≥ºÂÖ•‰æ°Ê†ºÔºàÂÜÜÔºâ" step="0.1" />
                    <button class="add-btn" onclick="addIngredient()">È£üÊùê„ÇíÁôªÈå≤</button>
                </div>
                
                <div class="item-list" id="ingredients-list">
                    <!-- ÊùêÊñô„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                </div>
            </div>
            
            <!-- ÊñôÁêÜ„Éë„Éç„É´ -->
            <div class="panel small-dishes-panel">
                <div class="panel-title">ÊñôÁêÜ‰ΩúÊàê</div>
                
                <div class="form dish-form">
                    <div class="form-title">ÊñôÁêÜ„É¨„Ç∑„Éî‰ΩúÊàê</div>
                    <input type="text" id="dish-name" placeholder="ÊñôÁêÜÂêçÔºà‰æãÔºö„ÉÅ„Ç≠„É≥„ÇΩ„ÉÜ„ÉºÔºâ" />
                    
                    <div class="dish-builder" id="dish-builder" ondrop="dropToDish(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                        <div class="dish-builder-title">È£üÊùê„Çí„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶‰ΩøÁî®Èáè„ÇíË®≠ÂÆö</div>
                        <div class="dish-ingredients" id="dish-ingredients">
                            <!-- ÊñôÁêÜ„ÅÆÊùêÊñô„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                        </div>
                        <div class="dish-total" id="dish-total">ÂêàË®àÂéü‰æ°: ¬•0</div>
                    </div>
                    
                    <button class="add-btn" onclick="createDish()">ÊñôÁêÜ„Çí‰ΩúÊàê</button>
                </div>
                
                <div class="item-list" id="small-dishes-list">
                    <!-- ÊñôÁêÜ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                </div>
            </div>
            
            <!-- FOOD„Ç®„É™„Ç¢ -->
            <div class="final-food-area">
                <div class="food-section" ondrop="dropToFood(event)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                    <div class="food-header">
                        <div class="food-icon">üçΩÔ∏è</div>
                        <div class="food-title">FOOD</div>
                    </div>
                    <div class="food-items" id="food-items">
                        <div class="empty-state">ÊñôÁêÜ„Çí„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶„É°„Éã„É•„Éº„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                    </div>
                    <div class="food-subtotal" id="food-subtotal">ÂêàË®à: ¬•0</div>
                </div>
                <button class="finish-food-btn" onclick="finishFood()">ÂÆåÊàêÂìÅ„Å®„Åó„Å¶ÁôªÈå≤</button>
            </div>
        </div>

        <!-- ÂÆåÊàêÂìÅ„Éë„Éç„É´ -->
        <div class="panel finished-foods-panel">
            <div class="panel-title">ÂÆåÊàêÂìÅ„É™„Çπ„Éà</div>
            <div class="item-list" id="finished-foods-list">
                <!-- ÂÆåÊàêÂìÅ„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
            </div>
        </div>

        <!-- „Éï„É≠„Éº„ÉÜ„Ç£„É≥„Ç∞„Éâ„É≠„ÉÉ„Éó„Ç®„É™„Ç¢ -->
        <div class="floating-drop-area floating-dish-builder" id="floating-dish-builder">
            <div class="floating-title">üç≥ ÊñôÁêÜ„É¨„Ç∑„Éî‰ΩúÊàê</div>
            <div class="floating-content" ondrop="dropToDishFloating(event)" ondragover="allowDropFloating(event)" ondragleave="dragLeaveFloating(event)">
                <div style="color: #4caf50; font-weight: 600; margin-top: 50px;">
                    È£üÊùê„Çí„Åì„Åì„Å´„Éâ„É≠„ÉÉ„Éó„Åó„Å¶‰ΩøÁî®Èáè„ÇíË®≠ÂÆö
                </div>
            </div>
        </div>

        <div class="floating-drop-area floating-food-area" id="floating-food-area">
            <div class="floating-title">üçΩÔ∏è FOOD</div>
            <div class="floating-content" ondrop="dropToFoodFloating(event)" ondragover="allowDropFloating(event)" ondragleave="dragLeaveFloating(event)">
                <div style="color: #f57c00; font-weight: 600; margin-top: 50px;">
                    ÊñôÁêÜ„Çí„Åì„Åì„Å´„Éâ„É≠„ÉÉ„Éó„Åó„Å¶„É°„Éã„É•„Éº„Å´ËøΩÂä†
                </div>
            </div>
        </div>
        
        <div class="total-area">
            <div class="total-title">ÂêàË®àÂéü‰æ°</div>
            <div class="total-amount" id="total-amount">¬•0</div>
        </div>
    </div>

    <!-- ‰æ°Ê†ºÊ§úÁ¥¢„É¢„Éº„ÉÄ„É´ -->
    <div id="priceSearchModal" class="modal">
        <div class="modal-content search-modal-content">
            <div class="modal-header">
                <div class="modal-title">üîç ‰æ°Ê†ºÊ§úÁ¥¢</div>
                <span class="close" onclick="closePriceSearch()">&times;</span>
            </div>
            <div class="search-input-section">
                <div class="search-filters">
                    <div class="filter-row">
                        <label>È£üÊùêÂêç:</label>
                        <select id="search-ingredient-name" onchange="updateSearchResults()">
                            <option value="">„Åô„Åπ„Å¶</option>
                        </select>
                    </div>
                    <div class="filter-row">
                        <label>Ë≥ºÂÖ•ÂÖà:</label>
                        <select id="search-store" onchange="updateSearchResults()">
                            <option value="">„Åô„Åπ„Å¶</option>
                        </select>
                    </div>
                </div>
                <div class="search-results" id="search-results">
                    <!-- Ê§úÁ¥¢ÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                </div>
            </div>
        </div>
    </div>

    <!-- Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´ -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="edit-modal-title">È£üÊùê„ÇíÁ∑®ÈõÜ</div>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <div class="edit-input-section">
                <div class="edit-input-row">
                    <label>È£üÊùêÂêç:</label>
                    <input type="text" id="edit-ingredient-name" readonly>
                </div>
                <div class="edit-input-row">
                    <label>Ë≥ºÂÖ•ÂÖà:</label>
                    <input type="text" id="edit-ingredient-store" readonly>
                </div>
                <div class="edit-input-row">
                    <label>Ë≥ºÂÖ•Èáè:</label>
                    <input type="number" id="edit-ingredient-quantity" step="0.1" min="0">
                    <span id="edit-ingredient-unit"></span>
                </div>
                <div class="edit-input-row">
                    <label>Ë≥ºÂÖ•‰æ°Ê†º:</label>
                    <input type="number" id="edit-ingredient-price" step="0.1" min="0">
                    <span>ÂÜÜ</span>
                </div>
                <div class="edit-preview" id="edit-preview">
                    Âçò‰æ°: ¬•0
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeEditModal()">„Ç≠„É£„É≥„Çª„É´</button>
                <button class="modal-btn confirm" onclick="confirmEdit()">Êõ¥Êñ∞</button>
            </div>
        </div>
    </div>

    <!-- ‰ΩøÁî®ÈáèÂÖ•Âäõ„É¢„Éº„ÉÄ„É´ -->
    <div id="quantityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="quantity-modal-title">‰ΩøÁî®Èáè„ÇíÂÖ•Âäõ</div>
                <span class="close" onclick="closeQuantityModal()">&times;</span>
            </div>
            <div class="quantity-input-section">
                <div class="quantity-input-row">
                    <label>‰ΩøÁî®Èáè:</label>
                    <input type="number" id="use-quantity" placeholder="‰ΩøÁî®Èáè" step="0.1" min="0">
                    <select id="use-unit">
                        <option value="g">g</option>
                        <option value="ÂÄã">ÂÄã</option>
                    </select>
                </div>
                <div class="cost-preview" id="cost-preview">
                    Âéü‰æ°: ¬•0
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn cancel" onclick="closeQuantityModal()">„Ç≠„É£„É≥„Çª„É´</button>
                <button class="modal-btn confirm" onclick="confirmQuantity()">ËøΩÂä†</button>
            </div>
        </div>
    </div>

    <script>
        let ingredients = [];
        let smallDishes = [];
        let foodItems = [];
        let finishedFoods = [];
        let currentDishIngredients = [];
        let currentIngredientForQuantity = null;
        let currentMode = '';

        let currentIngredientForEdit = null;

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´„Éá„Éº„Çø„ÇíÂæ©ÂÖÉ
        window.onload = function() {
            loadData();
            updateDisplay();
        };

        // „É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫Èñ¢Êï∞
        function showMessage(message, type = 'success') {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 
                                  type === 'update' ? 'update-message' : 'error-message';
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, type === 'success' ? 2000 : 3000);
        }

        // È£üÊùê„ÇíË≥ºÂÖ•ÁôªÈå≤
        function addIngredient() {
            const name = document.getElementById('ingredient-name').value.trim();
            const store = document.getElementById('ingredient-store').value;
            const quantity = parseFloat(document.getElementById('ingredient-quantity').value);
            const unit = document.getElementById('ingredient-unit').value;
            const price = parseFloat(document.getElementById('ingredient-price').value);

            if (!name || !store || !quantity || !unit || !price) {
                showMessage('„Åô„Åπ„Å¶„ÅÆÈ†ÖÁõÆ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            if (quantity <= 0 || price <= 0) {
                showMessage('Êï∞Èáè„Å®‰æ°Ê†º„ÅØ0„Çà„ÇäÂ§ß„Åç„ÅÑÂÄ§„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            // Âêå„ÅòÈ£üÊùêÂêç„Å®Ë≥ºÂÖ•ÂÖà„ÅÆÁµÑ„ÅøÂêà„Çè„Åõ„ÅåÊó¢„Å´Â≠òÂú®„Åô„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
            const existingIngredient = ingredients.find(ing => 
                ing.name === name && ing.store === store && ing.unit === unit
            );

            if (existingIngredient) {
                // Êó¢Â≠ò„Éá„Éº„Çø„ÇíÊõ¥Êñ∞
                existingIngredient.quantity = quantity;
                existingIngredient.price = price;
                existingIngredient.unitPrice = price / quantity;
                existingIngredient.updatedAt = Date.now();
                
                saveData();
                updateDisplay();
                clearIngredientForm();
                showMessage(`${name}Ôºà${store}Ôºâ„ÅÆ‰æ°Ê†ºÊÉÖÂ†±„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü`, 'update');
                return;
            }

            // Êñ∞Ë¶èËøΩÂä†
            const ingredient = {
                id: Date.now(),
                name: name,
                store: store,
                quantity: quantity,
                unit: unit,
                price: price,
                unitPrice: price / quantity,
                type: 'ingredient',
                createdAt: Date.now()
            };

            ingredients.push(ingredient);
            saveData();
            updateDisplay();
            clearIngredientForm();
            showMessage(`${name}Ôºà${store}Ôºâ„ÇíÁôªÈå≤„Åó„Åæ„Åó„Åü`);
        }

        function clearIngredientForm() {
            document.getElementById('ingredient-name').value = '';
            document.getElementById('ingredient-store').value = 'DIO';
            document.getElementById('ingredient-quantity').value = '';
            document.getElementById('ingredient-unit').value = 'g';
            document.getElementById('ingredient-price').value = '';
        }

        function createDish() {
            const name = document.getElementById('dish-name').value.trim();
            
            if (!name) {
                showMessage('ÊñôÁêÜÂêç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            if (currentDishIngredients.length === 0) {
                showMessage('ÊùêÊñô„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            const totalPrice = currentDishIngredients.reduce((sum, ing) => sum + ing.usedCost, 0);
            
            const dish = {
                id: Date.now(),
                name: name,
                ingredients: [...currentDishIngredients],
                price: totalPrice,
                type: 'dish',
                createdAt: Date.now()
            };

            smallDishes.push(dish);
            currentDishIngredients = [];
            document.getElementById('dish-name').value = '';
            saveData();
            updateDisplay();
            showMessage(`${name}„Çí‰ΩúÊàê„Åó„Åæ„Åó„Åü`);
        }

        // ‰æ°Ê†ºÊ§úÁ¥¢Ê©üËÉΩ
        function openPriceSearch() {
            populateSearchFilters();
            updateSearchResults();
            document.getElementById('priceSearchModal').style.display = 'block';
        }

        function closePriceSearch() {
            document.getElementById('priceSearchModal').style.display = 'none';
        }

        function populateSearchFilters() {
            const ingredientSelect = document.getElementById('search-ingredient-name');
            const storeSelect = document.getElementById('search-store');
            
            // È£üÊùêÂêç„ÅÆÈÅ∏ÊäûËÇ¢„ÇíÁîüÊàê
            const uniqueIngredients = [...new Set(ingredients.map(ing => ing.name))].sort();
            ingredientSelect.innerHTML = '<option value="">„Åô„Åπ„Å¶</option>';
            uniqueIngredients.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                ingredientSelect.appendChild(option);
            });
            
            // Ë≥ºÂÖ•ÂÖà„ÅÆÈÅ∏ÊäûËÇ¢„ÇíÁîüÊàê
            const uniqueStores = [...new Set(ingredients.map(ing => ing.store))].sort();
            storeSelect.innerHTML = '<option value="">„Åô„Åπ„Å¶</option>';
            uniqueStores.forEach(store => {
                const option = document.createElement('option');
                option.value = store;
                option.textContent = store;
                storeSelect.appendChild(option);
            });
        }

        function updateSearchResults() {
            const selectedIngredient = document.getElementById('search-ingredient-name').value;
            const selectedStore = document.getElementById('search-store').value;
            const resultsContainer = document.getElementById('search-results');
            
            // „Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            let filteredIngredients = ingredients.filter(ing => {
                return (selectedIngredient === '' || ing.name === selectedIngredient) &&
                       (selectedStore === '' || ing.store === selectedStore);
            });
            
            if (filteredIngredients.length === 0) {
                resultsContainer.innerHTML = '<div class="no-results">Ë©≤ÂΩì„Åô„ÇãÈ£üÊùê„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</div>';
                return;
            }
            
            // Âçò‰æ°„ÅßÊòáÈ†Ü„ÇΩ„Éº„Éà
            filteredIngredients.sort((a, b) => a.unitPrice - b.unitPrice);
            
            // ÊúÄÂÆâÂÄ§„ÇíÁâπÂÆö
            const cheapestPrice = filteredIngredients[0].unitPrice;
            
            // ÁµêÊûú„ÇíË°®Á§∫
            resultsContainer.innerHTML = '';
            filteredIngredients.forEach((ingredient, index) => {
                const div = document.createElement('div');
                div.className = 'search-result-item';
                
                // ÊúÄÂÆâÂÄ§„ÅÆÂ†¥Âêà„ÅØ„Éè„Ç§„É©„Ç§„Éà
                if (ingredient.unitPrice === cheapestPrice) {
                    div.classList.add('cheapest');
                }
                
                const updatedDate = ingredient.updatedAt ? 
                    new Date(ingredient.updatedAt).toLocaleDateString('ja-JP') : 
                    new Date(ingredient.createdAt || Date.now()).toLocaleDateString('ja-JP');
                
                div.innerHTML = `
                    <div class="search-result-header">
                        <div class="search-result-name">
                            ${ingredient.name}
                            ${ingredient.unitPrice === cheapestPrice ? '<span class="cheapest-badge">ÊúÄÂÆâÂÄ§</span>' : ''}
                        </div>
                        <div class="search-result-price">¬•${ingredient.unitPrice.toFixed(2)}/${ingredient.unit}</div>
                    </div>
                    <div class="search-result-details">
                        <div>
                            <span class="search-result-store">${ingredient.store}</span>
                            <span style="margin-left: 10px;">${ingredient.quantity}${ingredient.unit} - ¬•${ingredient.price}</span>
                        </div>
                        <div style="color: #999; font-size: 0.8rem;">Êõ¥Êñ∞: ${updatedDate}</div>
                    </div>
                `;
                
                resultsContainer.appendChild(div);
            });
        }

        function editIngredient(id) {
            const ingredient = ingredients.find(ing => ing.id === id);
            if (!ingredient) {
                showMessage('È£üÊùê„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì', 'error');
                return;
            }

            currentIngredientForEdit = ingredient;
            
            document.getElementById('edit-modal-title').textContent = `${ingredient.name} „ÇíÁ∑®ÈõÜ`;
            document.getElementById('edit-ingredient-name').value = ingredient.name;
            document.getElementById('edit-ingredient-store').value = ingredient.store;
            document.getElementById('edit-ingredient-quantity').value = ingredient.quantity;
            document.getElementById('edit-ingredient-unit').textContent = ingredient.unit;
            document.getElementById('edit-ingredient-price').value = ingredient.price;
            
            updateEditPreview();
            
            document.getElementById('editModal').style.display = 'block';
            
            // ÂÖ•Âäõ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÇíËøΩÂä†
            document.getElementById('edit-ingredient-quantity').oninput = updateEditPreview;
            document.getElementById('edit-ingredient-price').oninput = updateEditPreview;
            
            document.getElementById('edit-ingredient-quantity').focus();
        }

        function updateEditPreview() {
            const quantity = parseFloat(document.getElementById('edit-ingredient-quantity').value) || 0;
            const price = parseFloat(document.getElementById('edit-ingredient-price').value) || 0;
            
            if (quantity > 0) {
                const unitPrice = price / quantity;
                document.getElementById('edit-preview').textContent = `Âçò‰æ°: ¬•${unitPrice.toFixed(2)}/${currentIngredientForEdit.unit}`;
            } else {
                document.getElementById('edit-preview').textContent = 'Âçò‰æ°: ¬•0';
            }
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            currentIngredientForEdit = null;
        }

        function confirmEdit() {
            const quantity = parseFloat(document.getElementById('edit-ingredient-quantity').value);
            const price = parseFloat(document.getElementById('edit-ingredient-price').value);
            
            if (!quantity || quantity <= 0) {
                showMessage('Ê≠£„Åó„ÅÑÊï∞Èáè„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            if (!price || price <= 0) {
                showMessage('Ê≠£„Åó„ÅÑ‰æ°Ê†º„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            // È£üÊùêÊÉÖÂ†±„ÇíÊõ¥Êñ∞
            currentIngredientForEdit.quantity = quantity;
            currentIngredientForEdit.price = price;
            currentIngredientForEdit.unitPrice = price / quantity;
            currentIngredientForEdit.updatedAt = Date.now();
            
            saveData();
            updateDisplay();
            closeEditModal();
            showMessage(`${currentIngredientForEdit.name}„ÅÆÊÉÖÂ†±„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü`, 'update');
        }

        function deleteIngredient(id) {
            if (confirm('„Åì„ÅÆÈ£üÊùê„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                ingredients = ingredients.filter(ing => ing.id !== id);
                saveData();
                updateDisplay();
                showMessage('È£üÊùê„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
            }
        }

        function deleteDish(id) {
            if (confirm('„Åì„ÅÆÊñôÁêÜ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                smallDishes = smallDishes.filter(dish => dish.id !== id);
                saveData();
                updateDisplay();
                showMessage('ÊñôÁêÜ„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
            }
        }

        function deleteFinishedFood(id) {
            if (confirm('„Åì„ÅÆÂÆåÊàêÂìÅ„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
                finishedFoods = finishedFoods.filter(food => food.id !== id);
                saveData();
                updateDisplay();
                showMessage('ÂÆåÊàêÂìÅ„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
            }
        }

        function updateDisplay() {
            updateIngredientsList();
            updateSmallDishesList();
            updateDishBuilder();
            updateFoodSection();
            updateFinishedFoodsList();
            updateTotals();
        }

        function updateIngredientsList() {
            const list = document.getElementById('ingredients-list');
            list.innerHTML = '';

            ingredients.forEach(ingredient => {
                const div = document.createElement('div');
                div.className = 'item';
                div.draggable = true;
                div.dataset.itemId = ingredient.id;
                div.dataset.itemType = 'ingredient';
                div.ondragstart = function(e) {
                    e.dataTransfer.setData('text/plain', JSON.stringify({
                        id: ingredient.id,
                        type: 'ingredient'
                    }));
                    startDrag('ingredient', e);
                };
                div.ondragend = function(e) {
                    endDrag();
                };

                div.innerHTML = `
                    <div class="item-name">${ingredient.name}</div>
                    <div class="item-store">Ë≥ºÂÖ•ÂÖà: ${ingredient.store}</div>
                    <div class="item-details">
                        <span>Ë≥ºÂÖ•: ${ingredient.quantity}${ingredient.unit} - ¬•${ingredient.price}</span>
                        <div class="item-buttons">
                            <button class="edit-btn" onclick="editIngredient(${ingredient.id})" title="Á∑®ÈõÜ">‚úèÔ∏è</button>
                            <button class="delete-btn" onclick="deleteIngredient(${ingredient.id})">&times;</button>
                        </div>
                    </div>
                    <div style="font-size: 0.8rem; color: #666; font-style: italic;">Âçò‰æ°: ¬•${ingredient.unitPrice.toFixed(2)}/${ingredient.unit}</div>
                `;

                list.appendChild(div);
            });

            if (ingredients.length === 0) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'empty-state';
                emptyDiv.textContent = 'È£üÊùê„ÇíË≥ºÂÖ•ÁôªÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                list.appendChild(emptyDiv);
            }
        }

        function updateSmallDishesList() {
            const list = document.getElementById('small-dishes-list');
            list.innerHTML = '';

            smallDishes.forEach(dish => {
                const div = document.createElement('div');
                div.className = 'item small-dish-item';
                div.draggable = true;
                div.dataset.itemId = dish.id;
                div.dataset.itemType = 'dish';
                div.ondragstart = function(e) {
                    e.dataTransfer.setData('text/plain', JSON.stringify({
                        id: dish.id,
                        type: 'dish'
                    }));
                    startDrag('dish', e);
                };
                div.ondragend = function(e) {
                    endDrag();
                };

                const ingredientsList = dish.ingredients.map(ing => 
                    `${ing.name}(${ing.usedQuantity}${ing.unit})`
                ).join(', ');

                div.innerHTML = `
                    <div class="item-name">${dish.name}</div>
                    <div style="font-size: 0.8rem; color: #666; margin-bottom: 8px;">${ingredientsList}</div>
                    <div style="font-weight: 600; color: #2e7d32;">Âéü‰æ°: ¬•${dish.price.toFixed(2)}</div>
                    <button class="delete-btn" onclick="deleteDish(${dish.id})">&times;</button>
                `;

                list.appendChild(div);
            });

            if (smallDishes.length === 0) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'empty-state';
                emptyDiv.textContent = 'ÊñôÁêÜ„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                list.appendChild(emptyDiv);
            }
        }

        function updateDishBuilder() {
            const container = document.getElementById('dish-ingredients');
            const totalElement = document.getElementById('dish-total');
            
            container.innerHTML = '';
            let total = 0;

            if (currentDishIngredients.length === 0) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'empty-state';
                emptyDiv.textContent = 'È£üÊùê„Çí„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶‰ΩøÁî®Èáè„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                emptyDiv.style.color = '#81c784';
                emptyDiv.style.fontSize = '0.9rem';
                container.appendChild(emptyDiv);
            } else {
                currentDishIngredients.forEach((ingredient, index) => {
                    const div = document.createElement('div');
                    div.className = 'dish-ingredient';
                    div.innerHTML = `
                        <span>${ingredient.name}(${ingredient.store}) - ${ingredient.usedQuantity}${ingredient.unit} (¬•${ingredient.usedCost.toFixed(2)})</span>
                        <button class="dish-ingredient-remove" onclick="removeFromDish(${index})">&times;</button>
                    `;
                    container.appendChild(div);
                    total += ingredient.usedCost;
                });
            }

            totalElement.textContent = `ÂêàË®àÂéü‰æ°: ¬•${total.toFixed(2)}`;
        }

        function removeFromDish(index) {
            currentDishIngredients.splice(index, 1);
            updateDishBuilder();
        }

        function updateFoodSection() {
            const container = document.getElementById('food-items');
            
            if (foodItems.length === 0) {
                container.innerHTML = '<div class="empty-state">ÊñôÁêÜ„Çí„Éâ„É©„ÉÉ„Ç∞„Åó„Å¶„É°„Éã„É•„Éº„Çí‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>';
            } else {
                container.innerHTML = '';
                foodItems.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'food-item';
                    
                    let details = '';
                    if (item.type === 'dish') {
                        const ingredientsList = item.ingredients.map(ing => 
                            `${ing.name}(${ing.usedQuantity}${ing.unit})`
                        ).join(', ');
                        details = `<div class="food-item-details">${ingredientsList}</div>`;
                    }
                    
                    div.innerHTML = `
                        <div class="food-item-name">${item.name}</div>
                        ${details}
                        <div class="food-item-cost">Âéü‰æ°: ¬•${item.price.toFixed(2)}</div>
                        <button class="remove-food-item" onclick="removeFromFood(${item.id})">&times;</button>
                    `;
                    container.appendChild(div);
                });
            }
        }

        function updateFinishedFoodsList() {
            const list = document.getElementById('finished-foods-list');
            list.innerHTML = '';

            finishedFoods.forEach(food => {
                const div = document.createElement('div');
                div.className = 'item finished-food-item';
                div.onclick = function() {
                    showFoodDetails(food);
                };

                const date = new Date(food.createdAt).toLocaleDateString('ja-JP');

                div.innerHTML = `
                    <div class="item-name">${food.name}</div>
                    <div style="font-weight: 600; color: #e65100;">Âéü‰æ°: ¬•${food.totalCost.toFixed(2)}</div>
                    <div style="font-size: 0.7rem; color: #999; margin-top: 4px;">${date}</div>
                    <button class="delete-btn" onclick="deleteFinishedFood(${food.id}); event.stopPropagation()" style="position: absolute; top: 8px; right: 8px;">&times;</button>
                `;

                list.appendChild(div);
            });

            if (finishedFoods.length === 0) {
                const emptyDiv = document.createElement('div');
                emptyDiv.className = 'empty-state';
                emptyDiv.textContent = 'ÂÆåÊàêÂìÅ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì';
                list.appendChild(emptyDiv);
            }
        }

        function showFoodDetails(food) {
            let detailsHTML = '<div style="font-size: 1.1rem; margin-bottom: 15px; color: #ff6f00; font-weight: bold;">‰ΩøÁî®ÊñôÁêÜ„ÉªÂéü‰æ°Ë©≥Á¥∞</div>';
            
            food.items.forEach(item => {
                detailsHTML += `<div style="background: rgba(255,152,0,0.1); padding: 10px; margin: 8px 0; border-radius: 8px; border-left: 4px solid #ff9800;">`;
                detailsHTML += `<strong>${item.name}</strong> - ¬•${item.price.toFixed(2)}<br>`;
                
                if (item.ingredients) {
                    detailsHTML += '<div style="font-size: 0.9rem; color: #666; margin-top: 5px;">‰ΩøÁî®ÊùêÊñô: ';
                    detailsHTML += item.ingredients.map(ing => `${ing.name}(${ing.store})(${ing.usedQuantity}${ing.unit})`).join(', ');
                    detailsHTML += '</div>';
                }
                detailsHTML += '</div>';
            });
            
            detailsHTML += `<div style="background: #ff9800; color: white; padding: 15px; border-radius: 12px; text-align: center; font-size: 1.3rem; font-weight: bold; margin-top: 20px;">ÂêàË®àÂéü‰æ°: ¬•${food.totalCost.toFixed(2)}</div>`;
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                display: block;
                position: fixed;
                z-index: 2000;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.5);
                backdrop-filter: blur(5px);
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background-color: white;
                margin: 5% auto;
                padding: 30px;
                border-radius: 20px;
                width: 80%;
                max-width: 600px;
                max-height: 80vh;
                overflow-y: auto;
                box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            `;
            
            content.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #ffe0b2;">
                    <div style="font-size: 1.8rem; font-weight: 600; color: #ff6f00;">${food.name}</div>
                    <span style="color: #aaa; font-size: 2rem; font-weight: bold; cursor: pointer;" onclick="this.closest('.modal-temp').remove()">&times;</span>
                </div>
                ${detailsHTML}
            `;
            
            modal.className = 'modal-temp';
            modal.appendChild(content);
            document.body.appendChild(modal);
            
            modal.onclick = function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            };
        }

        function updateTotals() {
            const foodTotal = foodItems.reduce((sum, item) => sum + item.price, 0);
            document.getElementById('food-subtotal').textContent = `ÂêàË®à: ¬•${foodTotal.toFixed(2)}`;
            document.getElementById('total-amount').textContent = `¬•${foodTotal.toFixed(2)}`;
        }

        function finishFood() {
            if (foodItems.length === 0) {
                showMessage('FOOD„Ç®„É™„Ç¢„Å´ÊñôÁêÜ„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            const foodName = prompt('ÂÆåÊàêÂìÅ„ÅÆÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:');
            if (!foodName || !foodName.trim()) {
                return;
            }

            const totalCost = foodItems.reduce((sum, item) => sum + item.price, 0);
            
            const finishedFood = {
                id: Date.now(),
                name: foodName.trim(),
                items: [...foodItems],
                totalCost: totalCost,
                createdAt: Date.now()
            };

            finishedFoods.push(finishedFood);
            foodItems = [];
            saveData();
            updateDisplay();
            showMessage(`„Äå${foodName}„Äç„ÇíÂÆåÊàêÂìÅ„Å®„Åó„Å¶ÁôªÈå≤„Åó„Åæ„Åó„ÅüÔºÅ`);
        }

        // „Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„ÉóÈñ¢ÈÄ£
        function startDrag(type, event) {
            const rect = event.target.getBoundingClientRect();
            const rightX = rect.right + 20;
            const centerY = rect.top + rect.height / 2;
            
            if (type === 'ingredient') {
                showFloatingDishBuilder(rightX, centerY);
            } else if (type === 'dish') {
                showFloatingFoodArea(rightX, centerY);
            }
        }

        function endDrag() {
            hideFloatingAreas();
        }

        function showFloatingDishBuilder(x, y) {
            const floatingArea = document.getElementById('floating-dish-builder');
            const adjusted = adjustFloatingPosition(x, y);
            floatingArea.style.left = adjusted.x + 'px';
            floatingArea.style.top = adjusted.y + 'px';
            floatingArea.classList.add('show');
        }

        function showFloatingFoodArea(x, y) {
            const floatingArea = document.getElementById('floating-food-area');
            const adjusted = adjustFloatingPosition(x, y);
            floatingArea.style.left = adjusted.x + 'px';
            floatingArea.style.top = adjusted.y + 'px';
            floatingArea.classList.add('show');
        }

        function adjustFloatingPosition(x, y) {
            const windowWidth = window.innerWidth;
            const elementWidth = 400;
            
            if (x + elementWidth > windowWidth - 50) {
                x = x - elementWidth - 50;
            }
            
            const windowHeight = window.innerHeight;
            const elementHeight = 200;
            
            if (y + elementHeight > windowHeight - 50) {
                y = windowHeight - elementHeight - 50;
            }
            if (y < 50) {
                y = 50;
            }
            
            return { x, y };
        }

        function hideFloatingAreas() {
            document.getElementById('floating-dish-builder').classList.remove('show');
            document.getElementById('floating-food-area').classList.remove('show');
        }

        function allowDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function dragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function allowDropFloating(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function dragLeaveFloating(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function dropToDish(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const dragData = JSON.parse(e.dataTransfer.getData('text/plain'));
            
            if (dragData.type === 'ingredient') {
                const ingredient = ingredients.find(ing => ing.id === dragData.id);
                if (ingredient) {
                    showQuantityModal(ingredient, 'dish');
                }
            }
        }

        function dropToFood(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const dragData = JSON.parse(e.dataTransfer.getData('text/plain'));
            
            if (dragData.type === 'dish') {
                const dish = smallDishes.find(d => d.id === dragData.id);
                if (dish) {
                    foodItems.push({...dish});
                    saveData();
                    updateDisplay();
                    showMessage(`${dish.name}„Çí„É°„Éã„É•„Éº„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü`);
                }
            }
        }

        function dropToDishFloating(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const dragData = JSON.parse(e.dataTransfer.getData('text/plain'));
            
            if (dragData.type === 'ingredient') {
                const ingredient = ingredients.find(ing => ing.id === dragData.id);
                if (ingredient) {
                    showQuantityModal(ingredient, 'dish');
                }
            }
        }

        function dropToFoodFloating(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const dragData = JSON.parse(e.dataTransfer.getData('text/plain'));
            
            if (dragData.type === 'dish') {
                const dish = smallDishes.find(d => d.id === dragData.id);
                if (dish) {
                    foodItems.push({...dish});
                    saveData();
                    updateDisplay();
                    showMessage(`${dish.name}„Çí„É°„Éã„É•„Éº„Å´ËøΩÂä†„Åó„Åæ„Åó„Åü`);
                }
            }
        }

        function removeFromFood(itemId) {
            const item = foodItems.find(item => item.id === itemId);
            if (item) {
                foodItems = foodItems.filter(item => item.id !== itemId);
                saveData();
                updateDisplay();
                showMessage(`${item.name}„Çí„É°„Éã„É•„Éº„Åã„ÇâÂâäÈô§„Åó„Åæ„Åó„Åü`);
            }
        }

        // ‰ΩøÁî®ÈáèÂÖ•Âäõ„É¢„Éº„ÉÄ„É´Èñ¢ÈÄ£
        function showQuantityModal(ingredient, mode) {
            currentIngredientForQuantity = ingredient;
            currentMode = mode;
            
            document.getElementById('quantity-modal-title').textContent = `${ingredient.name}(${ingredient.store}) „ÅÆ‰ΩøÁî®Èáè„ÇíÂÖ•Âäõ`;
            document.getElementById('use-quantity').value = '';
            document.getElementById('use-unit').value = ingredient.unit;
            document.getElementById('cost-preview').textContent = 'Âéü‰æ°: ¬•0';
            
            const unitSelect = document.getElementById('use-unit');
            unitSelect.innerHTML = `<option value="${ingredient.unit}">${ingredient.unit}</option>`;
            
            document.getElementById('quantityModal').style.display = 'block';
            
            document.getElementById('use-quantity').oninput = updateCostPreview;
            document.getElementById('use-quantity').focus();
        }

        function updateCostPreview() {
            const quantity = parseFloat(document.getElementById('use-quantity').value) || 0;
            if (currentIngredientForQuantity && quantity > 0) {
                const cost = currentIngredientForQuantity.unitPrice * quantity;
                document.getElementById('cost-preview').textContent = `Âéü‰æ°: ¬•${cost.toFixed(2)}`;
            } else {
                document.getElementById('cost-preview').textContent = 'Âéü‰æ°: ¬•0';
            }
        }

        function closeQuantityModal() {
            document.getElementById('quantityModal').style.display = 'none';
            currentIngredientForQuantity = null;
            currentMode = '';
        }

        function confirmQuantity() {
            const quantity = parseFloat(document.getElementById('use-quantity').value);
            const unit = document.getElementById('use-unit').value;
            
            if (!quantity || quantity <= 0) {
                showMessage('Ê≠£„Åó„ÅÑ‰ΩøÁî®Èáè„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ', 'error');
                return;
            }

            if (quantity > currentIngredientForQuantity.quantity) {
                showMessage(`Ë≥ºÂÖ•Èáè(${currentIngredientForQuantity.quantity}${unit})„ÇíË∂Ö„Åà„Å¶„ÅÑ„Åæ„Åô`, 'error');
                return;
            }

            const usedCost = currentIngredientForQuantity.unitPrice * quantity;
            
            if (currentMode === 'dish') {
                const dishIngredient = {
                    ...currentIngredientForQuantity,
                    usedQuantity: quantity,
                    usedCost: usedCost
                };
                currentDishIngredients.push(dishIngredient);
                updateDishBuilder();
                showMessage(`${currentIngredientForQuantity.name}(${currentIngredientForQuantity.store})„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü`);
            }
            
            closeQuantityModal();
        }

        // „Éá„Éº„ÇøÁÆ°ÁêÜÈñ¢ÈÄ£
        function saveData() {
            const data = {
                ingredients: ingredients,
                smallDishes: smallDishes,
                foodItems: foodItems,
                finishedFoods: finishedFoods,
                currentDishIngredients: currentDishIngredients,
                version: "2.1",
                timestamp: Date.now()
            };
            
            try {
                localStorage.setItem('cookingCostData', JSON.stringify(data));
                console.log('„Éá„Éº„Çø„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü');
            } catch (e) {
                console.log('„Éá„Éº„Çø‰øùÂ≠ò„Ç®„É©„Éº:', e);
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem('cookingCostData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    ingredients = Array.isArray(data.ingredients) ? data.ingredients : [];
                    smallDishes = Array.isArray(data.smallDishes) ? data.smallDishes : [];
                    foodItems = Array.isArray(data.foodItems) ? data.foodItems : [];
                    finishedFoods = Array.isArray(data.finishedFoods) ? data.finishedFoods : [];
                    currentDishIngredients = Array.isArray(data.currentDishIngredients) ? data.currentDishIngredients : [];
                    
                    // „Éá„Éº„ÇøÊï¥ÂêàÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
                    ingredients.forEach(ingredient => {
                        if (!ingredient.unitPrice && ingredient.price && ingredient.quantity) {
                            ingredient.unitPrice = ingredient.price / ingredient.quantity;
                        }
                        if (!ingredient.type) {
                            ingredient.type = 'ingredient';
                        }
                        // Ë≥ºÂÖ•ÂÖàÊÉÖÂ†±„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„Éá„Éï„Ç©„É´„ÉàÂÄ§„ÇíË®≠ÂÆö
                        if (!ingredient.store) {
                            ingredient.store = 'DIO';
                        }
                    });
                    
                    console.log('‰øùÂ≠ò„Åï„Çå„Åü„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„Åü');
                }
            } catch (e) {
                console.log('„Éá„Éº„ÇøË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', e);
            }
        }

        function exportData() {
            try {
                const data = {
                    ingredients: ingredients,
                    smallDishes: smallDishes,
                    foodItems: foodItems,
                    finishedFoods: finishedFoods,
                    currentDishIngredients: currentDishIngredients,
                    exportDate: new Date().toISOString(),
                    version: "2.1"
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                
                // ÁèæÂú®„ÅÆÊó•ÊôÇ„Åß„Éï„Ç°„Ç§„É´Âêç„ÇíÁîüÊàê
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const seconds = String(now.getSeconds()).padStart(2, '0');
                
                const filename = `cooking-cost-data_${year}${month}${day}_${hours}${minutes}${seconds}.json`;
                link.download = filename;
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showMessage(`„Éá„Éº„Çø„Çí ${filename} „Å®„Åó„Å¶‰øùÂ≠ò„Åó„Åæ„Åó„Åü`);
            } catch (e) {
                console.error('Export error:', e);
                showMessage('„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü', 'error');
            }
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            // „Éá„Éº„ÇøÊßãÈÄ†„ÅÆÊ§úË®º
                            if (!data || typeof data !== 'object') {
                                throw new Error('ÁÑ°Âäπ„Å™„Éá„Éº„ÇøÂΩ¢Âºè„Åß„Åô');
                            }
                            
                            // „Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
                            ingredients = Array.isArray(data.ingredients) ? data.ingredients : [];
                            smallDishes = Array.isArray(data.smallDishes) ? data.smallDishes : [];
                            foodItems = Array.isArray(data.foodItems) ? data.foodItems : [];
                            finishedFoods = Array.isArray(data.finishedFoods) ? data.finishedFoods : [];
                            currentDishIngredients = Array.isArray(data.currentDishIngredients) ? data.currentDishIngredients : [];
                            
                            // „Éá„Éº„ÇøÊï¥ÂêàÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
                            ingredients.forEach(ingredient => {
                                if (!ingredient.id) ingredient.id = Date.now() + Math.random();
                                if (!ingredient.unitPrice && ingredient.price && ingredient.quantity) {
                                    ingredient.unitPrice = ingredient.price / ingredient.quantity;
                                }
                                if (!ingredient.type) {
                                    ingredient.type = 'ingredient';
                                }
                                // Ë≥ºÂÖ•ÂÖàÊÉÖÂ†±„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„Éá„Éï„Ç©„É´„ÉàÂÄ§„ÇíË®≠ÂÆö
                                if (!ingredient.store) {
                                    ingredient.store = 'DIO';
                                }
                            });
                            
                            smallDishes.forEach(dish => {
                                if (!dish.id) dish.id = Date.now() + Math.random();
                                if (!dish.type) {
                                    dish.type = 'dish';
                                }
                                if (dish.ingredients) {
                                    dish.ingredients.forEach(ing => {
                                        if (!ing.usedCost && ing.usedQuantity && ing.unitPrice) {
                                            ing.usedCost = ing.usedQuantity * ing.unitPrice;
                                        }
                                        // Ë≥ºÂÖ•ÂÖàÊÉÖÂ†±„Åå„Å™„ÅÑÂ†¥Âêà„ÅØ„Éá„Éï„Ç©„É´„ÉàÂÄ§„ÇíË®≠ÂÆö
                                        if (!ing.store) {
                                            ing.store = 'DIO';
                                        }
                                    });
                                }
                            });
                            
                            finishedFoods.forEach(food => {
                                if (!food.id) food.id = Date.now() + Math.random();
                                if (!food.createdAt) food.createdAt = Date.now();
                            });
                            
                            saveData();
                            updateDisplay();
                            showMessage('„Éá„Éº„Çø„ÇíÊ≠£Â∏∏„Å´„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åó„ÅüÔºÅ');
                            
                        } catch (error) {
                            console.error('Import error:', error);
                            showMessage(`„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ${error.message}`, 'error');
                        }
                    };
                    reader.onerror = function() {
                        showMessage('„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü', 'error');
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function clearAllData() {
            if (confirm('„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂÖÉ„Å´Êàª„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                ingredients = [];
                smallDishes = [];
                foodItems = [];
                finishedFoods = [];
                currentDishIngredients = [];
                saveData();
                updateDisplay();
                showMessage('„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü');
            }
        }

        // „Çµ„É≥„Éó„É´„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÊ©üËÉΩ
        function loadSampleData() {
            if (confirm('„Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åô„ÅãÔºüÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÅØ‰∏äÊõ∏„Åç„Åï„Çå„Åæ„Åô„ÄÇ')) {
                // „Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíÁõ¥Êé•ÂÆöÁæ©ÔºàË≥ºÂÖ•ÂÖàÊÉÖÂ†±„ÇíËøΩÂä†Ôºâ
                const sampleData = {
                    ingredients: [
                        {
                            id: 1672531200001,
                            name: "È∂è„ÇÇ„ÇÇËÇâ",
                            store: "DIO",
                            quantity: 300,
                            unit: "g",
                            price: 480,
                            unitPrice: 1.6,
                            type: "ingredient"
                        },
                        {
                            id: 1672531200002,
                            name: "Áéâ„Å≠„Åé",
                            store: "„Ç≥„Çπ„É¢„Çπ",
                            quantity: 150,
                            unit: "g",
                            price: 80,
                            unitPrice: 0.533,
                            type: "ingredient"
                        },
                        {
                            id: 1672531200003,
                            name: "‰∫∫ÂèÇ",
                            store: "„Éã„Ç∑„Éä",
                            quantity: 100,
                            unit: "g",
                            price: 60,
                            unitPrice: 0.6,
                            type: "ingredient"
                        },
                        {
                            id: 1672531200004,
                            name: "„Åò„ÇÉ„Åå„ÅÑ„ÇÇ",
                            store: "„Ç≥„Éº„Éó",
                            quantity: 200,
                            unit: "g",
                            price: 120,
                            unitPrice: 0.6,
                            type: "ingredient"
                        },
                        {
                            id: 1672531200005,
                            name: "Âçµ",
                            store: "DIO",
                            quantity: 6,
                            unit: "ÂÄã",
                            price: 180,
                            unitPrice: 30,
                            type: "ingredient"
                        }
                    ],
                    smallDishes: [],
                    foodItems: [],
                    finishedFoods: [],
                    currentDishIngredients: []
                };

                ingredients = sampleData.ingredients;
                smallDishes = sampleData.smallDishes;
                foodItems = sampleData.foodItems;
                finishedFoods = sampleData.finishedFoods;
                currentDishIngredients = sampleData.currentDishIngredients;
                
                saveData();
                updateDisplay();
                showMessage('„Çµ„É≥„Éó„É´„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø„Åæ„Åó„ÅüÔºÅ');
            }
        }

        // „É¢„Éº„ÉÄ„É´„ÅÆÂ§ñÂÅ¥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Åü„ÇâÈñâ„Åò„Çã
        window.onclick = function(event) {
            const quantityModal = document.getElementById('quantityModal');
            const editModal = document.getElementById('editModal');
            const searchModal = document.getElementById('priceSearchModal');
            
            if (event.target === quantityModal) {
                closeQuantityModal();
            }
            if (event.target === editModal) {
                closeEditModal();
            }
            if (event.target === searchModal) {
                closePriceSearch();
            }
        }

        // „Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà
        document.addEventListener('keydown', function(e) {
            // Esc„Ç≠„Éº„Åß„É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
            if (e.key === 'Escape') {
                closeQuantityModal();
                closeEditModal();
                closePriceSearch();
            }
            
            // Enter„Ç≠„Éº„Åß„É¢„Éº„ÉÄ„É´ÂÜÖ„ÅÆÁ¢∫ÂÆö„Éú„Çø„É≥„ÇíÊäº„Åô
            if (e.key === 'Enter') {
                if (document.getElementById('quantityModal').style.display === 'block') {
                    e.preventDefault();
                    confirmQuantity();
                } else if (document.getElementById('editModal').style.display === 'block') {
                    e.preventDefault();
                    confirmEdit();
                }
            }
        });

        // „Éï„Ç©„Éº„É†ÈÄÅ‰ø°„ÇíÈò≤„Åê
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.target.tagName === 'INPUT') {
                e.preventDefault();
                
                // È£üÊùêÁôªÈå≤„Éï„Ç©„Éº„É†ÂÜÖ„ÅßEnter„ÅåÊäº„Åï„Çå„ÅüÂ†¥Âêà
                if (e.target.closest('.form') && !e.target.closest('.modal')) {
                    if (e.target.id === 'ingredient-name' || 
                        e.target.id === 'ingredient-quantity' || 
                        e.target.id === 'ingredient-unit' || 
                        e.target.id === 'ingredient-price') {
                        addIngredient();
                    } else if (e.target.id === 'dish-name') {
                        createDish();
                    }
                }
            }
        });

        // „Çø„ÉÉ„ÉÅ„Éá„Éê„Ç§„ÇπÂØæÂøú
        let touchStartY = 0;
        let touchEndY = 0;

        document.addEventListener('touchstart', function(e) {
            touchStartY = e.changedTouches[0].screenY;
        }, { passive: true });

        document.addEventListener('touchend', function(e) {
            touchEndY = e.changedTouches[0].screenY;
            handleSwipe();
        }, { passive: true });

        function handleSwipe() {
            const swipeThreshold = 50;
            const diff = touchStartY - touchEndY;
            
            if (Math.abs(diff) > swipeThreshold) {
                // „Çπ„ÉØ„Ç§„ÉóÂá¶ÁêÜ„ÅØÂøÖË¶Å„Å´Âøú„Åò„Å¶ÂÆüË£Ö
            }
        }

        // „É™„Çµ„Ç§„Ç∫ÂØæÂøú
        window.addEventListener('resize', function() {
            hideFloatingAreas();
        });

        // ÂàùÊúüÂåñÂÆå‰∫Ü„É°„ÉÉ„Çª„Éº„Ç∏
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ÊñôÁêÜÂéü‰æ°Ë®àÁÆó„Ç∑„Çπ„ÉÜ„É†„ÅåÂàùÊúüÂåñ„Åï„Çå„Åæ„Åó„Åü');
        });
    </script>
</body>
</html>